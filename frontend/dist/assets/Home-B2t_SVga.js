import{r as C,u as J}from"./index-CZ6S7rlw.js";import{r as y,c as W,k as X,y as m,z as o,Q as t,I as a,A as n,al as d,M as k,K,H as u,P as O,a6 as P,az as Y,O as _,u as f}from"./vendor-D5-y3bXE.js";import{E as c,b as M,c as V}from"./element-DwdeTbvH.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee=i=>C({url:"/api/messages",method:"get",params:i}),se=i=>C({url:"/api/messages",method:"post",data:i}),te=i=>C({url:`/api/messages/${i}/like`,method:"post"}),ae=i=>C({url:`/api/messages/${i}/like`,method:"delete"}),oe=i=>C({url:"/api/messages/hot",method:"get",params:i}),ne={class:"home-container"},le={class:"mt-12",style:{"text-align":"right"}},re={class:"card-header"},ce={key:0},ie={key:0,class:"loading-container"},de={class:"message-item"},ue={class:"meta"},_e={class:"username"},pe={class:"time"},me={class:"content"},fe={class:"actions"},ve={class:"like-count"},ge={key:0,class:"hot-badge"},he={key:1},ye={key:0,class:"loading-container"},ke={class:"message-item hot-message"},be={class:"meta"},we={class:"username"},Le={class:"time"},Ce={class:"content"},Ae={class:"actions"},Me={class:"like-count"},Ve={class:"hot-badge"},xe={__name:"Home",setup(i){const v=y([]),g=y([]),w=y(""),x=y(!1),H=y(!1),T=y(!1),b=y("all"),B=J(),z=Y(),N=W(()=>B.isLoggedIn),A=async()=>{try{x.value=!0;const e=await ee();console.log("留言列表响应:",e),e&&e.data&&e.data.content?v.value=e.data.content:Array.isArray(e)?v.value=e:e&&e.data&&Array.isArray(e.data)?v.value=e.data:v.value=(e==null?void 0:e.data)||e||[],console.log("解析后的留言列表:",v.value)}catch(e){console.error("获取留言失败:",e),c.error("获取留言失败")}finally{x.value=!1}},S=async()=>{try{T.value=!0;const e=await oe();console.log("热门留言响应:",e),e&&e.data&&e.data.content?g.value=e.data.content:Array.isArray(e)?g.value=e:e&&e.data&&Array.isArray(e.data)?g.value=e.data:g.value=(e==null?void 0:e.data)||e||[],console.log("解析后的热门留言:",g.value)}catch(e){console.error("获取热门留言失败:",e),c.error("获取热门留言失败")}finally{T.value=!1}},$=async(e,l)=>{var h,r;if(!N.value){c.warning("请先登录"),z.push("/login");return}try{l?(await ae(e),c.success("取消点赞成功")):(await te(e),c.success("点赞成功")),b.value==="all"?A():S()}catch(L){console.error("点赞操作失败:",L),c.error(((r=(h=L.response)==null?void 0:h.data)==null?void 0:r.message)||"操作失败")}},Q=e=>{b.value=e,e==="hot"?S():A()},R=async()=>{var e,l,h;if(!N.value){c.warning("请先登录"),z.push("/login");return}if(!w.value.trim()){c.warning("请输入留言内容");return}try{H.value=!0,await se({content:w.value}),c.success("发布成功"),w.value="",A()}catch(r){console.error(r),((e=r.response)==null?void 0:e.status)===401?(c.error("登录已过期，请重新登录"),B.logout(),z.push("/login")):((l=r.response)==null?void 0:l.status)===400&&c.error(((h=r.response.data)==null?void 0:h.message)||"发布失败，请检查输入")}finally{H.value=!1}},E=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch{return e}};return X(A),(e,l)=>{const h=d("el-input"),r=d("el-button"),L=d("el-card"),I=d("el-tab-pane"),j=d("el-tabs"),D=d("el-skeleton"),U=d("el-empty"),p=d("el-icon"),q=d("el-timeline-item"),F=d("el-timeline");return o(),m("div",ne,[t(L,{class:"mb-16"},{header:a(()=>l[2]||(l[2]=[n("div",{class:"card-header"},"发布新留言",-1)])),default:a(()=>[t(h,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=s=>w.value=s),type:"textarea",rows:3,placeholder:"说点什么..."},null,8,["modelValue"]),n("div",le,[t(r,{type:"primary",loading:H.value,onClick:R},{default:a(()=>l[3]||(l[3]=[k("发布",-1)])),_:1,__:[3]},8,["loading"])])]),_:1}),t(L,null,{header:a(()=>[n("div",re,[t(j,{modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=s=>b.value=s),onTabChange:Q},{default:a(()=>[t(I,{label:"全部留言",name:"all"}),t(I,{label:"热门留言",name:"hot"})]),_:1},8,["modelValue"])])]),default:a(()=>[b.value==="all"?(o(),m("div",ce,[x.value?(o(),m("div",ie,[t(D,{rows:3,animated:""})])):v.value.length===0?(o(),u(U,{key:1,description:"暂无留言"})):(o(),u(F,{key:2},{default:a(()=>[(o(!0),m(O,null,P(v.value,s=>(o(),u(q,{key:s.id},{default:a(()=>[n("div",de,[n("div",ue,[n("span",_e,_(s.username||"未知用户"),1),n("span",pe,_(E(s.createdAt||s.created_at)),1)]),n("div",me,_(s.content),1),n("div",fe,[t(r,{type:s.isLiked?"danger":"primary",size:"small",onClick:G=>$(s.id,s.isLiked)},{default:a(()=>[s.isLiked?(o(),u(p,{key:0},{default:a(()=>[t(f(M))]),_:1})):(o(),u(p,{key:1},{default:a(()=>[t(f(V))]),_:1})),k(" "+_(s.isLiked?"取消点赞":"点赞"),1)]),_:2},1032,["type","onClick"]),n("span",ve,[t(p,null,{default:a(()=>[t(f(V))]),_:1}),k(" "+_(s.likeCount||0),1)]),s.isHot?(o(),m("span",ge,[t(p,null,{default:a(()=>[t(f(M))]),_:1}),l[4]||(l[4]=k(" 热门 ",-1))])):K("",!0)])])]),_:2},1024))),128))]),_:1}))])):b.value==="hot"?(o(),m("div",he,[T.value?(o(),m("div",ye,[t(D,{rows:3,animated:""})])):g.value.length===0?(o(),u(U,{key:1,description:"暂无热门留言"})):(o(),u(F,{key:2},{default:a(()=>[(o(!0),m(O,null,P(g.value,s=>(o(),u(q,{key:s.id},{default:a(()=>[n("div",ke,[n("div",be,[n("span",we,_(s.username||"未知用户"),1),n("span",Le,_(E(s.createdAt||s.created_at)),1)]),n("div",Ce,_(s.content),1),n("div",Ae,[t(r,{type:s.isLiked?"danger":"primary",size:"small",onClick:G=>$(s.id,s.isLiked)},{default:a(()=>[s.isLiked?(o(),u(p,{key:0},{default:a(()=>[t(f(M))]),_:1})):(o(),u(p,{key:1},{default:a(()=>[t(f(V))]),_:1})),k(" "+_(s.isLiked?"取消点赞":"点赞"),1)]),_:2},1032,["type","onClick"]),n("span",Me,[t(p,null,{default:a(()=>[t(f(V))]),_:1}),k(" "+_(s.likeCount||0),1)]),n("span",Ve,[t(p,null,{default:a(()=>[t(f(M))]),_:1}),l[5]||(l[5]=k(" 热门 ",-1))])])])]),_:2},1024))),128))]),_:1}))])):K("",!0)]),_:1})])}}},Ne=Z(xe,[["__scopeId","data-v-b5e386ab"]]);export{Ne as default};
